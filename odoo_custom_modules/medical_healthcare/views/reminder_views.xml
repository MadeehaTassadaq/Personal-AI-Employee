<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Reminder Configuration Views -->
        <record id="view_reminder_config_list" model="ir.ui.view">
            <field name="name">medical.reminder.config.list</field>
            <field name="model">medical.reminder.config</field>
            <field name="arch" type="xml">
                <list>
                    <field name="sequence" widget="handle"/>
                    <field name="name"/>
                    <field name="reminder_hours_before"/>
                    <field name="active" widget="boolean_favorite"/>
                    <field name="send_whatsapp"/>
                    <field name="send_email"/>
                    <field name="reminder_sent_count"/>
                    <field name="last_sent_date"/>
                </list>
            </field>
        </record>

        <record id="view_reminder_config_form" model="ir.ui.view">
            <field name="name">medical.reminder.config.form</field>
            <field name="model">medical.reminder.config</field>
            <field name="arch" type="xml">
                <form>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="Reminder Configuration Name"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                    <field name="active"/>
                                    <field name="sequence"/>
                                    <field name="reminder_hours_before"/>
                                </group>
                            <group>
                                    <field name="reminder_sent_count" readonly="1"/>
                                    <field name="last_sent_date" readonly="1"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="Channels" name="channels">
                                <group>
                                        <group string="Communication Channels">
                                                    <field name="send_whatsapp"/>
                                                    <field name="send_email"/>
                                                    <field name="send_sms"/>
                                                </group>
                                        <group>
                                                    <field name="email_template_id" invisible="[('send_email', '=', False)]"/>
                                                </group>
                                </group>
                            </page>

                            <page string="WhatsApp Message" name="whatsapp">
                                <group>
                                        <field name="whatsapp_template" widget="text" nolabel="1" colspan="2"/>
                                </group>
                                <group>
                                        <field name="include_doctor_name"/>
                                        <field name="include_clinic_address"/>
                                        <field name="include_preparation_instructions"/>
                                        <field name="preparation_instructions" nolabel="1" colspan="2"
                                                    placeholder="Special instructions for patient (e.g., Please fast for 12 hours before appointment)"
                                                    invisible="[('include_preparation_instructions', '=', False)]"/>
                                </group>
                            </page>

                            <page string="Filters" name="filters">
                                <group>
                                        <field name="appointment_type_ids" widget="many2many_tags" nolabel="1" colspan="2"/>
                                        <field name="risk_category_filter"/>
                                </group>
                            </page>

                            <page string="Preview" name="preview">
                                <p>Message Preview:</p>
                                <div class="alert alert-info" style="white-space: pre-wrap;">
                                    <field name="whatsapp_template" readonly="1"/>
                                </div>
                                <p class="text-muted">
                                    Available variables:
                                    {patient_name}, {appointment_date}, {appointment_time},
                                    {doctor_name}, {clinic_name}
                                </p>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="action_reminder_config" model="ir.actions.act_window">
            <field name="name">Reminder Configurations</field>
            <field name="res_model">medical.reminder.config</field>
            <field name="view_mode">list,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_empty_folder">
                        No reminder configurations found. Create one to start sending automatic appointment reminders.
                    </p>
            </field>
        </record>

        <!-- Reminder History Views -->
        <record id="view_reminder_history_list" model="ir.ui.view">
            <field name="name">medical.reminder.history.list</field>
            <field name="model">medical.reminder.history</field>
            <field name="arch" type="xml">
                <list>
                    <field name="sent_date"/>
                    <field name="appointment_id"/>
                    <field name="patient_id"/>
                    <field name="config_id"/>
                    <field name="hours_before"/>
                    <field name="channel" widget="badge"/>
                    <field name="status" widget="badge"/>
                    <field name="patient_response" widget="badge"/>
                </list>
            </field>
        </record>

        <record id="view_reminder_history_form" model="ir.ui.view">
            <field name="name">medical.reminder.history.form</field>
            <field name="model">medical.reminder.history</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button name="mark_confirmed" string="Mark Confirmed" type="object"
                                    class="btn-primary"
                                    invisible="[('patient_response', '!=', 'no_response')]"/>
                        <button name="mark_no_show" string="Mark No Show" type="object"
                                    class="btn-warning"
                                    invisible="[('patient_response', '!=', 'no_response')]"/>
                        <field name="status" widget="statusbar"/>
                        <field name="patient_response" widget="statusbar"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                    <field name="appointment_id"/>
                                    <field name="patient_id"/>
                                    <field name="config_id"/>
                                    <field name="sent_date"/>
                                </group>
                            <group>
                                    <field name="hours_before"/>
                                    <field name="channel"/>
                                    <field name="response_date"/>
                                    <field name="delivery_status"/>
                                </group>
                        </group>

                        <notebook>
                            <page string="Message" name="message">
                                <group>
                                        <field name="phone_number"/>
                                        <field name="email_address"/>
                                </group>
                                <group>
                                        <field name="message" nolabel="1" colspan="2" widget="text"/>
                                </group>
                            </page>

                            <page string="Error Details" name="error">
                                <group>
                                        <field name="error_message" nolabel="1" colspan="2" widget="text"/>
                                </group>
                            </page>

                            <page string="Notes" name="notes">
                                <group>
                                        <field name="notes" nolabel="1" colspan="2" widget="text"/>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="action_reminder_history" model="ir.actions.act_window">
            <field name="name">Reminder History</field>
            <field name="res_model">medical.reminder.history</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('sent_date', '>=', (context_today() - datetime.timedelta(days=30)).strftime('%Y-%m-%d'))]</field>
        </record>

        <!-- Appointment Type Views -->
        <record id="view_appointment_type_list" model="ir.ui.view">
            <field name="name">medical.appointment.type.list</field>
            <field name="model">medical.appointment.type</field>
            <field name="arch" type="xml">
                <list>
                    <field name="sequence" widget="handle"/>
                    <field name="name"/>
                    <field name="code"/>
                    <field name="default_duration"/>
                    <field name="active"/>
                </list>
            </field>
        </record>

        <record id="view_appointment_type_form" model="ir.ui.view">
            <field name="name">medical.appointment.type.form</field>
            <field name="model">medical.appointment.type</field>
            <field name="arch" type="xml">
                <form>
                    <sheet>
                        <div class="oe_title">
                                    <h1>
                                            <field name="name" placeholder="Appointment Type Name"/>
                                            <field name="code" placeholder="CODE"/>
                                    </h1>
                                </div>
                        <group>
                                    <field name="sequence"/>
                                    <field name="default_duration"/>
                                    <field name="active"/>
                                </group>
                        <group>
                                    <field name="description" nolabel="1" colspan="2"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="action_appointment_type" model="ir.actions.act_window">
            <field name="name">Appointment Types</field>
            <field name="res_model">medical.appointment.type</field>
            <field name="view_mode">list,form</field>
        </record>

    </data>
</odoo>
